"use strict";(self.webpackChunkwebsite_operator=self.webpackChunkwebsite_operator||[]).push([[2278],{3905:function(e,t,r){r.d(t,{Zo:function(){return p},kt:function(){return k}});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function a(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function s(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?a(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),u=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):s(s({},t),e)),r},p=function(e){var t=u(e.components);return n.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(r),k=o,h=d["".concat(l,".").concat(k)]||d[k]||c[k]||a;return r?n.createElement(h,s(s({ref:t},p),{},{components:r})):n.createElement(h,s({ref:t},p))}));function k(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,s=new Array(a);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var u=2;u<a;u++)s[u]=r[u];return n.createElement.apply(null,s)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},5374:function(e,t,r){r.r(t),r.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return u},toc:function(){return p},default:function(){return d}});var n=r(7462),o=r(3366),a=(r(7294),r(3905)),s=["components"],i={title:"Troubleshooting",description:"Troubleshooting"},l=void 0,u={unversionedId:"Troubleshooting",id:"Troubleshooting",isDocsHomePage:!1,title:"Troubleshooting",description:"Troubleshooting",source:"@site/docs/Troubleshooting.md",sourceDirName:".",slug:"/Troubleshooting",permalink:"/kubernetes-operator/next/Troubleshooting",editUrl:"https://github.com/aerospike/kubernetes-operator/edit/main/docs/Troubleshooting.md",tags:[],version:"current",frontMatter:{title:"Troubleshooting",description:"Troubleshooting"},sidebar:"docsSidebar",previous:{title:"Connect To The Aerospike Cluster",permalink:"/kubernetes-operator/next/Connect-to-the-Aerospike-cluster"},next:{title:"Limitations",permalink:"/kubernetes-operator/next/Limitations"}},p=[{value:"Pods stuck in pending state",id:"pods-stuck-in-pending-state",children:[]},{value:"Pods keep crashing",id:"pods-keep-crashing",children:[]},{value:"Error connecting to the cluster from outside Kubernetes",id:"error-connecting-to-the-cluster-from-outside-kubernetes",children:[]},{value:"Troubleshooting",id:"troubleshooting",children:[{value:"Events",id:"events",children:[]},{value:"Operator logs",id:"operator-logs",children:[]}]}],c={toc:p};function d(e){var t=e.components,r=(0,o.Z)(e,s);return(0,a.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Troubleshooting#pods-stuck-in-pending-state"},"Pods stuck in pending state")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Troubleshooting#pods-keep-crashing"},"Pods keep crashing")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Troubleshooting#error-connecting-to-the-cluster-from-outside-kubernetes"},"Error connecting to the cluster from outside Kubernetes")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Troubleshooting#troubleshooting"},"Troubleshooting"),(0,a.kt)("ul",{parentName:"li"},(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Troubleshooting#events"},"Events")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Troubleshooting#operator-logs"},"Operator logs"))))),(0,a.kt)("h2",{id:"pods-stuck-in-pending-state"},"Pods stuck in pending state"),(0,a.kt)("p",null,'After an Aerospike cluster has been created or updated if the pods are stuck with "Pending" status like so,'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"NAME          READY   STATUS      RESTARTS   AGE\naerocluster-0-0     1/1     Pending     0          48s\naerocluster-0-1     1/1     Pending     0          48s\n")),(0,a.kt)("p",null,"describe the pod to find the reason for scheduling failure."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n aerospike describe pod aerocluster-0-0\n")),(0,a.kt)("p",null,"Under the events section you will find the reason for the pod not being scheduled. For example"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"QoS Class:       Burstable\nNode-Selectors:  <none>\nTolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s\n                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\nEvents:\n  Type     Reason            Age                    From               Message\n  ----     ------            ----                   ----               -------\n  Warning  FailedScheduling  9m27s (x3 over 9m31s)  default-scheduler  0/1 nodes are available: 1 pod has unbound immediate PersistentVolumeClaims.\n  Warning  FailedScheduling  20s (x9 over 9m23s)    default-scheduler  0/1 nodes are available: 1 node(s) didn't match Pod's node affinity.\n\n")),(0,a.kt)("p",null,"Possible reasons are"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Storage class incorrect or not created. Please see ",(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Create-Aerospike-cluster#configure-persistent-storage"},"persistent storage")," configuration for details."),(0,a.kt)("li",{parentName:"ul"},"1 node(s) didn't match Pod's node affinity - Invalid zone, region, racklabel etc. for the rack configured for this pod."),(0,a.kt)("li",{parentName:"ul"},"Insufficient resources, CPU or memory available to schedule more pods.")),(0,a.kt)("h2",{id:"pods-keep-crashing"},"Pods keep crashing"),(0,a.kt)("p",null,'After an Aerospike cluster has been created or updated if the pods are stuck with "Error" or "CrashLoopBackOff" status like so,'),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"NAME          READY   STATUS      RESTARTS   AGE\naerocluster-0-0     1/1     Error     0          48s\naerocluster-0-1     1/1     CrashLoopBackOff     2          48s\n")),(0,a.kt)("p",null,"Check the following logs to see if pod initialization failed or the Aerospike Server stopped."),(0,a.kt)("p",null,"Init logs"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n aerospike logs aerocluster-0-0 -c aerospike-init\n")),(0,a.kt)("p",null,"Server logs"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n aerospike logs aerocluster-0-0 -c aerospike-server\n")),(0,a.kt)("p",null,"Possible reasons are"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Missing or incorrect feature key file - Fix by deleting the Aerospike secret and recreating it with correct feature key file. See ",(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Create-Aerospike-cluster#create-secrets"},"Aerospike secrets")," for details."),(0,a.kt)("li",{parentName:"ul"},"Bad Aerospike configuration - The operator tries to validate the configuration before applying it to the cluster. However it's still possible to misconfigure the Aerospike server. The offending paramter will be logged in the server logs and should be fixed and applied again to the cluster. See ",(0,a.kt)("a",{parentName:"li",href:"/kubernetes-operator/next/Aerospike-configuration-change"},"Aerospike configuration change")," for details.")),(0,a.kt)("h2",{id:"error-connecting-to-the-cluster-from-outside-kubernetes"},"Error connecting to the cluster from outside Kubernetes"),(0,a.kt)("p",null,"If the cluster runs fine as verfied by the pod status and asadm (see connecting with ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Connect-to-the-Aerospike-cluster#with-asadm"},"asadm"),"), Ensure that firewall allows inbound traffic to the Kubenetes cluster for the Aerospike ports. See ",(0,a.kt)("a",{parentName:"p",href:"/kubernetes-operator/next/Connect-to-the-Aerospike-cluster#port-access"},"Port access")," for details."),(0,a.kt)("h2",{id:"troubleshooting"},"Troubleshooting"),(0,a.kt)("h3",{id:"events"},"Events"),(0,a.kt)("p",null,"Events (High-level info on what is happening in the cluster) (scheduling failure, storage unavailable etc.)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n aerospike get events\n")),(0,a.kt)("h3",{id:"operator-logs"},"Operator logs"),(0,a.kt)("p",null,"List the operator instance and select the operator instance with READY column 1/1. This is the active operator instance even if you run multiple replicas for high availability."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl  -n aerospike get pod\n\nNAME                                             READY   STATUS    RESTARTS   AGE\naerocluster-0-0                                  2/2     Running   0          133m\naerocluster-0-1                                  2/2     Running   0          133m\naerocluster-0-2                                  2/2     Running   0          12m\naerospike-kubernetes-operator-5f44549fc9-hwk8k   0/1     Running   0          15m\naerospike-kubernetes-operator-5f44549fc9-n7vj2   1/1     Running   0          15m\n")),(0,a.kt)("p",null,"Get the log"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n aerospike logs aerospike-kubernetes-operator-5f44549fc9-n7vj2\n")),(0,a.kt)("p",null,"Add the -f flag to follow the logs continuously."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"kubectl -n aerospike logs -f aerospike-kubernetes-operator-5f44549fc9-n7vj2\n")),(0,a.kt)("p",null,"The series of steps the operator follows to apply user changes are logged allow with debug information, errors, and warnings."))}d.isMDXComponent=!0}}]);